
# HG changeset patch
# User thartmann
# Date 1596694256 -7200
# Node ID b36c3f635d937798abe5e7c5a40a868705fed15e
# Parent  bc6816b211dbf43f967a012f6d1f8361148438d1
8250861: Crash in MinINode::Ideal(PhaseGVN*, bool)
Summary: Added missing NULL checks.
Reviewed-by: kvn, chagedorn

diff -r bc6816b211db -r b36c3f635d93 src/share/vm/opto/addnode.cpp
--- openjdk/hotspot/src/share/vm/opto/addnode.cpp	Wed Nov 04 21:53:14 2020 +0000
+++ openjdk/hotspot/src/share/vm/opto/addnode.cpp	Thu Aug 06 08:10:56 2020 +0200
@@ -918,7 +918,7 @@
 
     // Transform MIN2(x + c0, MIN2(x + c1, z)) into MIN2(x + MIN2(c0, c1), z)
     // if x == y and the additions can't overflow.
-    if (phase->eqv(x,y) &&
+    if (phase->eqv(x,y) && tx != NULL &&
         !can_overflow(tx, x_off) &&
         !can_overflow(tx, y_off)) {
       return new (phase->C) MinINode(phase->transform(new (phase->C) AddINode(x, phase->intcon(MIN2(x_off, y_off)))), r->in(2));
@@ -926,7 +926,7 @@
   } else {
     // Transform MIN2(x + c0, y + c1) into x + MIN2(c0, c1)
     // if x == y and the additions can't overflow.
-    if (phase->eqv(x,y) &&
+    if (phase->eqv(x,y) && tx != NULL &&
         !can_overflow(tx, x_off) &&
         !can_overflow(tx, y_off)) {
       return new (phase->C) AddINode(x,phase->intcon(MIN2(x_off,y_off)));

